<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .loading {
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="loading">Se încarcă, te redirecționăm...</div>

    <script>
        // Așteaptă ca API-ul Telegram WebApp să fie gata
        Telegram.WebApp.ready();

        // Dezactivează swipe-down pentru a preveni închiderea aplicației
        Telegram.WebApp.disableSwipeDown();

        // Obține initData pentru gestionarea sesiunii
        const initData = Telegram.WebApp.initData;

        // Verifică dacă initData este disponibil
        if (initData) {
            // Parsează initData pentru a obține informații despre utilizator
            const userData = parseInitData(initData);
            console.log('User Data:', userData);

            // Salvează informațiile despre sesiune în localStorage
            localStorage.setItem('userSession', JSON.stringify(userData));
        }

        // Funcție pentru a parsa initData
        function parseInitData(initData) {
            const params = new URLSearchParams(initData);
            const user = JSON.parse(params.get('user'));
            return {
                id: user.id,
                firstName: user.first_name,
                lastName: user.last_name,
                username: user.username
            };
        }

        // Funcție pentru a redirecționa utilizatorul către ref link
        function redirectToRefLink() {
            const refLink = 'https://your-ref-link.com'; // Înlocuiește cu link-ul tău
            window.location.href = refLink;
        }

        // Verifică dacă există o sesiune salvată în localStorage
        const savedSession = localStorage.getItem('userSession');
        if (savedSession) {
            const sessionData = JSON.parse(savedSession);
            console.log('Saved Session:', sessionData);
            // Poți folosi sessionData pentru a autentifica utilizatorul
        }

        // Așteaptă 100 ms pentru a permite paginii să se încarce complet
        setTimeout(() => {
            redirectToRefLink();
        }, 100);
    </script>
</body>
</html>